<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MikeTheTiger.AI | LSU Knowledge Widget</title>
  <link rel="stylesheet" href="../styles.css">
  <style>
    :root {
      --accent-lsu: #582c83;
      --accent-gold: #fdd023;
      --accent-river: #6e7bff;
    }
    body { background: #04050c; }
    .container { max-width: 1150px; margin: 2rem auto 4rem; padding: 0 1.25rem; display: flex; flex-direction: column; gap: 1.5rem; }
    .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 1.5rem; }
    .hero-panel { padding: 2.5rem 1.75rem; border: 1px solid rgba(253,208,35,0.3); background: radial-gradient(circle at top, rgba(253,208,35,0.25), rgba(4,5,12,0.95)); }
    .hero-panel h1 { margin: 0 0 0.5rem; font-size: clamp(2rem, 5vw, 2.8rem); }
    .hero-panel p { margin: 0.35rem 0; max-width: 700px; }
    .hero-meta { display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 1rem; color: var(--muted); font-size: 0.9rem; }
    .meta-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); gap: 1rem; }
    .meta-card { background: rgba(88,44,131,0.25); border: 1px solid rgba(88,44,131,0.4); border-radius: 14px; padding: 1rem; backdrop-filter: blur(4px); }
    .meta-card strong { display: block; font-size: 0.75rem; letter-spacing: 0.08em; text-transform: uppercase; color: var(--muted); margin-bottom: 0.35rem; }
    .ask-panel { display: flex; flex-direction: column; gap: 0.75rem; }
    .ask-row { display: flex; gap: 0.5rem; flex-wrap: wrap; }
    .ask-row input { flex: 1; min-width: 220px; background: #080a16; border: 1px solid rgba(255,255,255,0.12); border-radius: 12px; color: #fff; padding: 0.95rem 1rem; font-size: 1rem; }
    .ask-row button { background: linear-gradient(135deg, var(--accent-gold), #ffb347); border: none; padding: 0 1.9rem; border-radius: 12px; color: #2b1d00; font-weight: 700; letter-spacing: 0.03em; cursor: pointer; transition: transform 0.12s ease, box-shadow 0.2s; }
    .ask-row button:hover { transform: translateY(-1px); box-shadow: 0 12px 24px rgba(253,208,35,0.35); }
    .chip-row { display: flex; flex-wrap: wrap; gap: 0.5rem; }
    .chip { border: 1px solid rgba(253,208,35,0.4); color: var(--fg); padding: 0.45rem 1rem; border-radius: 999px; font-size: 0.85rem; cursor: pointer; background: rgba(253,208,35,0.12); }
    .chip:hover { border-color: var(--accent-gold); background: rgba(253,208,35,0.2); }
    .response-panel { display: flex; flex-direction: column; gap: 1rem; }
    .response-status { font-size: 0.85rem; color: var(--muted); display: inline-flex; align-items: center; gap: 0.45rem; }
    .response-status::before { content: ''; width: 9px; height: 9px; border-radius: 50%; background: rgba(255,255,255,0.4); box-shadow: 0 0 10px rgba(253,208,35,0.5); }
    .response-status.live::before { background: #00d4aa; }
    .response-text p { margin: 0.35rem 0; line-height: 1.65; }
    .reference-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); gap: 0.8rem; }
    .reference-card { border: 1px solid rgba(255,255,255,0.08); border-radius: 12px; padding: 1rem; background: rgba(0,0,0,0.2); }
    .reference-card h4 { margin: 0 0 0.35rem; font-size: 1rem; color: var(--fg); }
    .reference-card p { margin: 0; font-size: 0.9rem; color: var(--muted); }
    .tag-pill { display: inline-flex; align-items: center; gap: 0.2rem; border: 1px solid rgba(255,255,255,0.13); border-radius: 999px; padding: 0.18rem 0.6rem; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--muted); }
    .facts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px,1fr)); gap: 1rem; }
    .fact-card { border: 1px solid rgba(255,255,255,0.09); border-radius: 12px; padding: 1rem; background: rgba(255,255,255,0.03); }
    .fact-card span { display: block; font-size: 0.72rem; letter-spacing: 0.08em; text-transform: uppercase; color: var(--muted); margin-bottom: 0.35rem; }
    .fact-card strong { font-size: 1.2rem; color: var(--fg); }
    .events-panel { display: flex; flex-direction: column; gap: 0.85rem; }
    .event-row { display: flex; gap: 0.9rem; align-items: flex-start; border-left: 3px solid var(--accent-gold); padding-left: 1rem; }
    .event-date { font-weight: 700; color: var(--accent-gold); min-width: 95px; font-variant-numeric: tabular-nums; }
    .event-row p { margin: 0.05rem 0 0; color: var(--muted); }
    .source-line { font-size: 0.8rem; color: var(--muted); margin-top: 0.4rem; }
    @media (max-width: 640px) { .ask-row button { width: 100%; } }
  </style>
</head>
<body>
  <header class="hero-panel">
    <p class="tag" style="color: var(--accent-gold);">♞ goodKnight / Demo</p>
    <h1>MikeTheTiger.AI</h1>
    <p class="lead">A searchable LSU concierge: ask about history, people, buildings, AI programs, or upcoming events. Everything runs client-side from a curated public fact pack.</p>
    <div class="hero-meta">
      <span id="meta-updated">Updated --</span>
      <span id="meta-source">Source: --</span>
      <span>Latency: <span id="meta-latency">--</span> ms</span>
    </div>
  </header>

  <main class="container">
    <section class="panel meta-grid" id="meta-grid">
      <div class="meta-card">
        <strong>Campus</strong>
        <div>1,000-acre live-oak campus on the Mississippi River · est. 1853</div>
      </div>
      <div class="meta-card">
        <strong>People</strong>
        <div>37k+ students · 5k faculty · alumni in all 64 parishes & 100+ countries</div>
      </div>
      <div class="meta-card">
        <strong>Tech Stack</strong>
        <div>CCT GPU supernodes · Stephenson E. I. S. · AI & Data Analytics minor</div>
      </div>
      <div class="meta-card">
        <strong>Why MikeTheTiger.AI?</strong>
        <div>Instant answers with transparent references — no opaque LLM hallucinations.</div>
      </div>
    </section>

    <section class="panel ask-panel">
      <div class="ask-row">
        <input id="question" type="text" placeholder="Try: Who was LSU's first quarterback? | Where is Patrick Taylor Hall? | How big is LSU?">
        <button id="ask-btn">Ask Mike</button>
      </div>
      <div class="chip-row" id="chip-row">
        <button class="chip" data-question="How many students attend LSU?">Enrollment</button>
        <button class="chip" data-question="Tell me about LSU's AI programs.">AI Programs</button>
        <button class="chip" data-question="Who was LSU's first quarterback?">First QB</button>
        <button class="chip" data-question="Where is Patrick Taylor Hall?">Engineering Hall</button>
        <button class="chip" data-question="Any LSU events this spring?">Events</button>
        <button class="chip" data-question="What is Mike the Tiger's habitat like?">Mike's Habitat</button>
      </div>
    </section>

    <section class="panel response-panel">
      <div class="response-status" id="response-status">Waiting for a question…</div>
      <div class="response-text" id="answer-text"></div>
      <div class="reference-grid" id="reference-grid"></div>
      <div class="source-line" id="source-line"></div>
    </section>

    <section class="panel">
      <h3>Quick Facts</h3>
      <div class="facts-grid" id="facts-grid"></div>
    </section>

    <section class="panel events-panel">
      <h3>Upcoming LSU Moments</h3>
      <div id="events-list"></div>
    </section>
  </main>

  <footer style="text-align:center; padding:2rem; color:var(--muted); font-size:0.8rem;">
    <p>Dataset: <code>data/lsu_facts.json</code> · Generated by goodKnight ♞</p>
    <p><a href="../" style="color: var(--accent-gold);">← Back to Signal Lab</a></p>
  </footer>

  <script>
    let knowledgeBase = [];
    let lsuData = null;
    const questionInput = document.getElementById('question');
    const askBtn = document.getElementById('ask-btn');
    const answerBox = document.getElementById('answer-text');
    const statusEl = document.getElementById('response-status');
    const refsEl = document.getElementById('reference-grid');
    const sourceLine = document.getElementById('source-line');

    async function init() {
      const t0 = performance.now();
      const resp = await fetch('../data/lsu_facts.json?t=' + Date.now());
      lsuData = await resp.json();
      const latency = Math.round(performance.now() - t0);
      document.getElementById('meta-latency').textContent = latency;
      document.getElementById('meta-updated').textContent = 'Updated ' + new Date(lsuData.updated_at).toLocaleString('en-US', { hour12: false });
      document.getElementById('meta-source').textContent = 'Source: ' + lsuData.source;
      hydrateKnowledge(lsuData);
      renderFacts(lsuData.stats);
      renderEvents(lsuData.events);
      sourceLine.textContent = 'Sources: ' + lsuData.source;
    }

    function hydrateKnowledge(data) {
      knowledgeBase = [];
      const pushEntry = (title, body, tags = [], links = []) => {
        const tokens = (title + ' ' + body).toLowerCase().match(/[a-z0-9']+/g) || [];
        knowledgeBase.push({ title, body, tags, links, tokens });
      };
      ['highlights', 'faqs', 'people', 'places', 'traditions', 'events'].forEach(section => {
        (data[section] || []).forEach(item => {
          const title = item.title || item.question || 'Entry';
          const body = item.body || item.answer || item.details || '';
          pushEntry(title, body, item.tags || [], item.links || []);
        });
      });
    }

    function scoreEntry(entry, questionTokens) {
      let score = 0;
      const joined = questionTokens.join(' ');
      entry.tags.forEach(tag => { if (joined.includes(tag)) score += 4; });
      questionTokens.forEach(token => { if (entry.tokens.includes(token)) score += 1; });
      return score;
    }

    function structuredStats(question) {
      if (!lsuData || !lsuData.stats) return [];
      const stats = lsuData.stats;
      const lowerQ = question.toLowerCase();
      const snippets = [];
      if (/(student|enrollment|population)/.test(lowerQ)) {
        snippets.push(`LSU enrolls roughly ${stats.students.toLocaleString()} students and employs ${stats.faculty.toLocaleString()} faculty.`);
      }
      if (/(research|r1|funding|grant|spend)/.test(lowerQ)) {
        snippets.push(`Research spending cleared $${(stats.research_spend/1e6).toFixed(0)}M last year, keeping LSU in the R1 tier.`);
      }
      if (/(mascot|tiger|mike)/.test(lowerQ)) {
        snippets.push(`Mascot: ${stats.mascot}. Colors: ${stats.colors}. Mike's habitat sits between Tiger Stadium and the PMAC.`);
      }
      if (/(history|founded|establish)/.test(lowerQ)) {
        snippets.push(`Founded in ${stats.founded} as Louisiana's flagship land-grant institution.`);
      }
      if (/(first.*quarterback)/.test(lowerQ) && stats.first_quarterback) {
        snippets.push(`LSU's first documented starting quarterback was ${stats.first_quarterback}, per the LSU Athletics media guide.`);
      }
      if (/(patrick.*taylor|pft|engineering hall)/.test(lowerQ) && stats.patrick_taylor_location) {
        snippets.push(`Patrick F. Taylor Hall anchors the College of Engineering on South Stadium Drive at Nicholson Extension.`);
      }
      return snippets;
    }

    function answerQuestion(q) {
      if (!q.trim()) return;
      statusEl.textContent = 'Searching curated fact pack…';
      statusEl.classList.add('live');
      answerBox.innerHTML = '';
      refsEl.innerHTML = '';

      const tokens = q.toLowerCase().match(/[a-z0-9']+/g) || [];
      const scored = knowledgeBase.map(entry => ({ entry, score: scoreEntry(entry, tokens) }))
        .filter(item => item.score > 0)
        .sort((a, b) => b.score - a.score)
        .slice(0, 4);

      const responseParts = structuredStats(q);
      if (scored.length) {
        scored.forEach((item, idx) => {
          const prefix = idx === 0 ? 'Primary match:' : 'Also note:';
          responseParts.push(`${prefix} ${item.entry.body}`);
        });
      }
      if (!responseParts.length) {
        responseParts.push("No direct match yet — ask about enrollment, buildings, athletics, AI programs, or events.");
      }

      const answerHTML = responseParts.map(line => `<p>${line}</p>`).join('');
      simulateTyping(answerHTML, () => {
        statusEl.textContent = 'Answer generated from LSU public fact pack.';
      });

      refsEl.innerHTML = scored.map(item => `
        <div class="reference-card">
          <h4>${item.entry.title}</h4>
          <p>${item.entry.body}</p>
          <div style="margin-top:0.35rem; display:flex; flex-wrap:wrap; gap:0.3rem;">
            ${(item.entry.tags || []).map(tag => `<span class="tag-pill">${tag}</span>`).join('')}
          </div>
          ${item.entry.links && item.entry.links.length ? `<div style="margin-top:0.45rem;"><a href="${item.entry.links[0]}" target="_blank" rel="noopener" style="color: var(--accent-gold); font-size:0.8rem;">Source ↗</a></div>` : ''}
        </div>
      `).join('');
    }

    function simulateTyping(html, callback) {
      answerBox.innerHTML = '';
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = html;
      const nodes = Array.from(tempDiv.childNodes);
      let idx = 0;
      function renderNext() {
        if (idx >= nodes.length) { if (callback) callback(); return; }
        answerBox.appendChild(nodes[idx]);
        idx += 1;
        setTimeout(renderNext, 110);
      }
      renderNext();
    }

    function renderFacts(stats = {}) {
      const facts = [
        { label: 'Founded', value: stats.founded },
        { label: 'Students', value: stats.students ? stats.students.toLocaleString() : '--' },
        { label: 'Faculty', value: stats.faculty ? stats.faculty.toLocaleString() : '--' },
        { label: 'Research Spend', value: stats.research_spend ? '$' + (stats.research_spend/1e6).toFixed(0) + 'M' : '--' },
        { label: 'Campus Acres', value: stats.campus_acres },
        { label: 'Mascot', value: stats.mascot },
        { label: 'Colors', value: stats.colors },
        { label: 'AI Ranking', value: stats.ranking_ai }
      ];
      document.getElementById('facts-grid').innerHTML = facts.map(f => `
        <div class="fact-card">
          <span>${f.label}</span>
          <strong>${f.value || '--'}</strong>
        </div>
      `).join('');
    }

    function renderEvents(events = []) {
      if (!events.length) {
        document.getElementById('events-list').innerHTML = '<p style="color:var(--muted)">No events recorded.</p>';
        return;
      }
      document.getElementById('events-list').innerHTML = events.map(evt => `
        <div class="event-row">
          <div class="event-date">${new Date(evt.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</div>
          <div>
            <strong>${evt.title}</strong>
            <p>${evt.details}</p>
          </div>
        </div>
      `).join('');
    }

    askBtn.addEventListener('click', () => answerQuestion(questionInput.value));
    questionInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        answerQuestion(questionInput.value);
      }
    });
    document.getElementById('chip-row').addEventListener('click', (e) => {
      if (e.target.matches('[data-question]')) {
        const q = e.target.getAttribute('data-question');
        questionInput.value = q;
        answerQuestion(q);
      }
    });

    init();
  </script>
</body>
</html>
